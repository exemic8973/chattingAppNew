<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soulè¯­éŸ³æˆ¿é—´æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border-radius: 15px;
            background: white;
            color: #333;
        }
        .test-section h2 {
            margin-top: 0;
            color: #FF6B6B;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "âœ¨ ";
            color: #FF6B6B;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ­ Soulè¯­éŸ³æˆ¿é—´æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>åŠŸèƒ½ç‰¹æ€§</h2>
            <ul class="feature-list">
                <li>ğŸ¤ å®æ—¶è¯­éŸ³é€šè¯</li>
                <li>ğŸ­ 6ç§æˆ¿é—´åˆ†ç±»ï¼ˆç¤¾äº¤ã€éŸ³ä¹ã€æ¸¸æˆã€å­¦ä¹ ã€æƒ…æ„Ÿã€éšæœºï¼‰</li>
                <li>ğŸ‘¥ åœ†å½¢åº§ä½å¸ƒå±€</li>
                <li>ğŸ¯ æ™ºèƒ½æ¨èç³»ç»Ÿ</li>
                <li>ğŸ“Š æˆ¿é—´ç®¡ç†åŠŸèƒ½</li>
                <li>ğŸ ç¤¼ç‰©å’Œè¡¨æƒ…äº’åŠ¨</li>
                <li>ğŸ” ç§äººæˆ¿é—´æ”¯æŒ</li>
                <li>ğŸ“± å®Œç¾ç§»åŠ¨ç«¯é€‚é…</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>è¿æ¥æµ‹è¯•</h2>
            <button id="testConnection">æµ‹è¯•Socketè¿æ¥</button>
            <button id="testSoulRooms">è·å–Soulæˆ¿é—´åˆ—è¡¨</button>
            <button id="testCreateRoom">åˆ›å»ºæµ‹è¯•æˆ¿é—´</button>
            <div id="connectionStatus" class="status info">æœªè¿æ¥</div>
        </div>

        <div class="test-section">
            <h2>åŠŸèƒ½æµ‹è¯•</h2>
            <button id="testVoiceDetection">æµ‹è¯•è¯­éŸ³æ£€æµ‹</button>
            <button id="testRoomJoin">æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´</button>
            <button id="testGiftSystem">æµ‹è¯•ç¤¼ç‰©ç³»ç»Ÿ</button>
            <div id="featureStatus" class="status info">æœªæµ‹è¯•</div>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•æ—¥å¿—</h2>
            <div id="log" class="log"></div>
            <button id="clearLog">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="test-section">
            <h2>ä½¿ç”¨è¯´æ˜</h2>
            <ol>
                <li>ç¡®ä¿æœåŠ¡å™¨è¿è¡Œåœ¨ <code>https://localhost:3001</code></li>
                <li>ç‚¹å‡»"æµ‹è¯•Socketè¿æ¥"éªŒè¯è¿æ¥</li>
                <li>ç‚¹å‡»"è·å–Soulæˆ¿é—´åˆ—è¡¨"æŸ¥çœ‹å¯ç”¨æˆ¿é—´</li>
                <li>åœ¨ä¸»åº”ç”¨ä¸­ç‚¹å‡» ğŸ­ æŒ‰é’®è¿›å…¥Soulè¯­éŸ³æˆ¿é—´</li>
                <li>åˆ›å»ºæˆ–åŠ å…¥æˆ¿é—´ä½“éªŒå®Œæ•´åŠŸèƒ½</li>
            </ol>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        // Test Socket Connection
        document.getElementById('testConnection').addEventListener('click', () => {
            updateStatus('connectionStatus', 'è¿æ¥ä¸­...', 'info');
            
            try {
                socket = io('https://localhost:3001', {
                    secure: false,
                    rejectUnauthorized: false
                });
                
                socket.on('connect', () => {
                    log('âœ… Socketè¿æ¥æˆåŠŸ');
                    updateStatus('connectionStatus', 'âœ… å·²è¿æ¥', 'success');
                });
                
                socket.on('disconnect', () => {
                    log('âŒ Socketè¿æ¥æ–­å¼€');
                    updateStatus('connectionStatus', 'âŒ å·²æ–­å¼€', 'error');
                });
                
                socket.on('connect_error', (error) => {
                    log(`âŒ è¿æ¥é”™è¯¯: ${error.message}`);
                    updateStatus('connectionStatus', `âŒ é”™è¯¯: ${error.message}`, 'error');
                });
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–é”™è¯¯: ${error.message}`);
                updateStatus('connectionStatus', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        });

        // Test Soul Rooms
        document.getElementById('testSoulRooms').addEventListener('click', () => {
            if (!socket || !socket.connected) {
                log('âŒ Socketæœªè¿æ¥');
                return;
            }
            
            log('è¯·æ±‚Soulæˆ¿é—´åˆ—è¡¨...');
            socket.emit('get_soul_rooms');
            
            socket.on('soul_rooms_updated', (rooms) => {
                log(`âœ… è·å–åˆ° ${rooms.length} ä¸ªSoulæˆ¿é—´`);
                rooms.forEach((room, index) => {
                    log(`  æˆ¿é—´${index + 1}: ${room.name} (${room.category}) - ${room.participantCount}/${room.maxParticipants}äºº`);
                });
            });
        });

        // Test Create Room
        document.getElementById('testCreateRoom').addEventListener('click', () => {
            if (!socket || !socket.connected) {
                log('âŒ Socketæœªè¿æ¥');
                return;
            }
            
            const testRoom = {
                name: 'æµ‹è¯•æˆ¿é—´-' + Date.now(),
                description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æˆ¿é—´',
                category: 'social',
                maxParticipants: 6,
                isPrivate: false
            };
            
            log(`åˆ›å»ºæµ‹è¯•æˆ¿é—´: ${testRoom.name}`);
            socket.emit('create_soul_room', testRoom);
            
            socket.on('soul_room_created', (room) => {
                log(`âœ… æˆ¿é—´åˆ›å»ºæˆåŠŸ: ${room.name} (${room.id})`);
            });
        });

        // Test Voice Detection
        document.getElementById('testVoiceDetection').addEventListener('click', async () => {
            try {
                log('è¯·æ±‚éº¦å…‹é£æƒé™...');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: { 
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    } 
                });
                
                log('âœ… éº¦å…‹é£æƒé™è·å–æˆåŠŸ');
                
                // Create audio context for voice detection
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                
                log('âœ… è¯­éŸ³æ£€æµ‹ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');
                updateStatus('featureStatus', 'âœ… è¯­éŸ³æ£€æµ‹æ­£å¸¸', 'success');
                
                // Stop test stream
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                log(`âŒ è¯­éŸ³æ£€æµ‹æµ‹è¯•å¤±è´¥: ${error.message}`);
                updateStatus('featureStatus', `âŒ è¯­éŸ³æ£€æµ‹å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // Test Room Join
        document.getElementById('testRoomJoin').addEventListener('click', () => {
            if (!socket || !socket.connected) {
                log('âŒ Socketæœªè¿æ¥');
                return;
            }
            
            const testUsername = 'æµ‹è¯•ç”¨æˆ·-' + Math.random().toString(36).substr(2, 9);
            log(`æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´ï¼Œç”¨æˆ·: ${testUsername}`);
            
            // Mock room join
            socket.emit('join_soul_room', {
                roomId: 'soul-1',
                username: testUsername
            });
            
            socket.on('soul_room_joined', (data) => {
                log(`âœ… æˆåŠŸåŠ å…¥æˆ¿é—´: ${data.room.name}`);
                log(`  å½“å‰å‚ä¸è€…: ${data.participants.length}äºº`);
                updateStatus('featureStatus', 'âœ… æˆ¿é—´åŠ å…¥æ­£å¸¸', 'success');
            });
        });

        // Test Gift System
        document.getElementById('testGiftSystem').addEventListener('click', () => {
            if (!socket || !socket.connected) {
                log('âŒ Socketæœªè¿æ¥');
                return;
            }
            
            log('æµ‹è¯•ç¤¼ç‰©ç³»ç»Ÿ...');
            socket.emit('soul_send_gift', {
                roomId: 'soul-1',
                giftType: 'rose',
                targetUsername: 'æµ‹è¯•ç”¨æˆ·'
            });
            
            socket.on('soul_gift_received', (data) => {
                log(`âœ… ç¤¼ç‰©å‘é€æˆåŠŸ: ${data.from} -> ${data.to} (${data.giftType})`);
                updateStatus('featureStatus', 'âœ… ç¤¼ç‰©ç³»ç»Ÿæ­£å¸¸', 'success');
            });
        });

        // Clear Log
        document.getElementById('clearLog').addEventListener('click', () => {
            document.getElementById('log').innerHTML = '';
        });

        // Initial log
        log('Soulè¯­éŸ³æˆ¿é—´æµ‹è¯•é¡µé¢å·²åŠ è½½');
        log('è¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œç„¶åå¼€å§‹æµ‹è¯•');
    </script>
</body>
</html>